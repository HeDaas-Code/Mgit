# 写作Copilot插件

## 简介

写作Copilot是MGit的AI驱动写作助手插件，设计理念参考GitHub Copilot，专注于提升写作体验和效率。该插件集成了多种AI辅助功能，并使用智能代理执行复杂的文档管理任务。

## 功能特性

### 1. 行内补全（Inline Completion）
- **自动触发**: 在输入时自动建议内容补全
- **手动触发**: 使用快捷键或按钮手动请求补全
- **智能上下文**: 基于当前文档内容和光标位置生成相关补全

### 2. 编辑模式（Edit Mode）
- **改进写作**: 提升选定文本的质量和可读性
- **修正语法**: 自动修正语法和拼写错误
- **扩展内容**: 为选定内容添加更多细节和说明
- **简化内容**: 精简和简化复杂文本
- **重写**: 用不同方式重新表述内容

### 3. 创作模式（Creation Mode）
- **提示驱动**: 基于用户提示生成全新内容
- **模板支持**: 使用预定义模板快速创作
- **结构化生成**: 生成符合特定格式的内容

### 4. 对话模式（Chat Mode）
- **上下文感知**: 基于当前文档内容回答问题
- **写作建议**: 提供写作改进建议和创意
- **实时交互**: 与AI助手进行自然语言对话

### 5. 代理模式（Agent Mode）
智能代理可以使用以下工具自动完成复杂任务：

#### 文档工具
- `read_current_document`: 读取当前打开的文档
- `read_document`: 读取指定文件
- `write_document`: 写入文档到文件
- `edit_current_document`: 编辑当前文档
- `append_to_document`: 在文档末尾追加内容
- `insert_at_cursor`: 在光标位置插入内容
- `list_documents`: 列出目录中的文档

#### Git工具
- `create_branch`: 创建新的Git分支
- `switch_branch`: 切换到指定分支
- `commit_changes`: 提交更改
- `get_git_status`: 获取Git状态
- `list_branches`: 列出所有分支
- `get_commit_history`: 获取提交历史

### 6. 任务审查系统（Task Review）
- **类似GitHub PR**: 审查代理完成的任务
- **差异查看**: 查看任务执行的详细步骤和结果
- **批准/拒绝**: 决定是否应用代理的更改
- **合并控制**: 手动控制更改的合并时机

## 安装配置

### 依赖安装

插件依赖以下Python包：
- `langchain>=0.1.0`
- `langchain-community>=0.0.20`
- `langchain-openai>=0.0.5`
- `openai>=1.0.0`

这些依赖已包含在`requirements.txt`中，首次使用时会自动安装。

### API配置

1. **获取SiliconFlow API密钥**
   - 访问 [SiliconFlow官网](https://siliconflow.cn/)
   - 注册账号并获取API密钥

2. **配置插件**
   - 在MGit中打开"插件设置"
   - 找到"写作Copilot"插件
   - 填入以下信息：
     - API基础URL: `https://api.siliconflow.cn/v1`（默认）
     - API密钥: 您的SiliconFlow API密钥
     - 模型名称: 选择合适的模型（默认使用DeepSeek V2.5）

### 可用模型

插件支持以下SiliconFlow模型：
- **DeepSeek V2.5**: 综合性能优秀的中文模型
- **Qwen2.5 7B**: 阿里通义千问系列
- **GLM-4 9B**: 智谱AI的对话模型
- **Llama 3.1 8B**: Meta的开源模型

## 使用指南

### 快速开始

1. **启用插件**
   - 在插件管理界面启用"写作Copilot"
   - 插件面板会出现在侧边栏

2. **配置API**
   - 确保已正确配置API密钥
   - 测试连接是否正常

3. **开始使用**
   - 打开或创建一个Markdown文档
   - 在插件面板选择相应的模式开始使用

### 行内补全使用

#### 自动补全
1. 在编辑器中输入文本
2. 停止输入1秒后（可配置）自动触发补全
3. 补全内容会显示在插件面板
4. 点击"接受"应用补全，或"拒绝"忽略

#### 手动补全
1. 将光标放在需要补全的位置
2. 点击"手动触发补全"按钮
3. 查看生成的补全建议
4. 选择接受或拒绝

### 编辑模式使用

1. 在编辑器中选择要编辑的文本
2. 切换到"编辑"标签页
3. 点击相应的编辑操作按钮
4. AI会处理选定文本并直接替换

### 创作模式使用

1. 切换到"创作"标签页
2. 在提示框中输入创作要求
   - 例如："写一篇关于Python编程的介绍"
3. 点击"生成内容"按钮
4. 查看生成的内容
5. 点击"插入到文档"将内容添加到当前文档

### 对话模式使用

1. 切换到"对话"标签页
2. 在输入框中输入问题或请求
   - 例如："这段文字如何改进？"
3. 按回车或点击"发送"
4. 查看AI的回复
5. 继续对话或点击"清除历史"开始新对话

### 代理模式使用

#### 简单任务示例

```
创建一个名为 feature/new-section 的分支，然后在当前文档中添加一个新章节"总结"。
```

#### 复杂任务示例

```
1. 读取所有.md文件
2. 在每个文件开头添加更新时间
3. 创建一个名为 update-timestamps 的分支
4. 提交所有更改，提交信息为"添加更新时间戳"
```

#### 执行流程

1. 切换到"代理"标签页
2. 在任务描述框中详细描述任务
3. 点击"执行任务"
4. 在日志中查看执行过程
5. 如果启用了任务审查，任务会加入审查队列

### 任务审查使用

1. 切换到"任务审查"标签页
2. 从列表中选择待审查的任务
3. 查看任务详情和执行步骤
4. 决定：
   - **批准并应用**: 确认更改并应用到文档
   - **拒绝**: 放弃该任务的更改

## 高级设置

### 补全设置

- **启用行内补全**: 开启/关闭自动补全功能
- **触发方式**: 
  - 自动触发: 停止输入后自动触发
  - 手动触发: 仅通过按钮触发
  - 两者都启用: 支持自动和手动两种方式
- **自动补全延迟**: 设置停止输入后多久触发（毫秒）

### 代理设置

- **启用任务审查**: 是否在应用代理更改前需要审查

### 高级设置

- **最大上下文长度**: 发送给AI的最大上下文字符数

## 使用技巧

### 编写有效的提示

1. **具体明确**: 清楚说明想要什么
   - ❌ "写点东西"
   - ✅ "写一段200字的产品介绍，突出创新性和实用性"

2. **提供上下文**: 给出足够的背景信息
   - ✅ "基于上文关于AI的讨论，总结主要观点"

3. **指定格式**: 说明期望的输出格式
   - ✅ "用Markdown格式，包含标题、段落和列表"

### 代理任务最佳实践

1. **任务分解**: 将复杂任务分解为清晰的步骤
2. **检查点**: 在关键步骤后添加验证
3. **错误处理**: 描述出错时的处理方式
4. **审查优先**: 启用任务审查以避免意外更改

### 性能优化

1. **上下文控制**: 减少不必要的上下文可以提高响应速度
2. **批量操作**: 合并多个小任务为一个大任务
3. **缓存利用**: 相似的请求会得到更快的响应

## 故障排除

### 常见问题

#### Q: 插件无法加载
**A**: 检查依赖是否正确安装：
```bash
pip install langchain langchain-community langchain-openai openai
```

#### Q: API调用失败
**A**: 
1. 检查API密钥是否正确
2. 确认网络连接正常
3. 验证API基础URL是否正确

#### Q: 补全不工作
**A**:
1. 确认"启用行内补全"已开启
2. 检查触发方式设置
3. 查看日志中的错误信息

#### Q: 代理任务执行失败
**A**:
1. 检查Git管理器是否可用
2. 确认有权限执行Git操作
3. 简化任务描述，分步执行

### 日志查看

在MGit主菜单中选择"帮助" > "查看日志"，可以查看详细的执行日志和错误信息。

## 开发者信息

### 插件架构

```
plugins/writing_copilot/
├── __init__.py           # 插件主入口
├── ui/
│   ├── __init__.py
│   └── copilot_widget.py # UI组件
├── tools/
│   ├── __init__.py
│   └── document_tools.py # 代理工具
├── agents/
│   └── __init__.py       # 代理相关
└── resources/            # 资源文件
```

### 扩展插件

开发者可以通过以下方式扩展插件：

1. **添加新工具**: 在`tools/`目录添加新的工具函数
2. **自定义代理**: 在`agents/`目录创建专用代理
3. **修改UI**: 扩展`ui/copilot_widget.py`添加新功能
4. **集成服务**: 添加对其他AI服务的支持

## 贡献

欢迎提交问题报告和功能建议！

## 许可证

本插件遵循MIT许可证。

## 更新日志

### v1.0.0 (2024)
- 初始版本发布
- 实现行内补全、编辑、创作、对话、代理五大模式
- 添加任务审查系统
- 支持SiliconFlow API
- 集成Langchain代理框架

## 致谢

- GitHub Copilot - 设计灵感
- SiliconFlow - AI模型API提供
- Langchain - 代理开发框架
- MGit团队 - 平台支持
