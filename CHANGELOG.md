# 更新日志

## OAuth认证流程优化 - 2023-12-15

### 功能改进

1. **优化的OAuth浏览器对话框**
   - 全面重构的资源管理机制，避免内存泄漏
   - 确保WebEngine资源在对话框关闭时完全释放
   - 改进重定向URL处理，增强成功率

2. **用户体验提升**
   - 优化OAuth授权成功/失败反馈界面
   - 自动关闭授权窗口，减少用户操作
   - 加载状态提示更加友好

3. **安全性增强**
   - 使用QUrlQuery替代parse_qs解析查询参数，提高安全性
   - 实现更完善的错误处理流程
   - 授权参数传递安全性提高

### 技术优化

1. **资源管理**
   - 实现链式信号断开处理，防止内存泄漏
   - 对WebEngine对象进行合理释放，避免资源残留
   - 添加垃圾回收强制触发，确保资源及时释放

2. **稳定性提升**
   - 改进closeEvent处理逻辑，确保对话框正确关闭
   - 添加异常处理保护，提高应用稳定性
   - 优化状态检查机制，避免重复授权请求

## 账号系统重构 - 2023-12-01

### 新增功能

1. **增强的账号管理系统**
   - 本地加密存储账号信息，提升安全性
   - 支持多账号切换
   - 自动登录功能
   - 头像加载和缓存
   - 账号设置面板

2. **认证方式扩展**
   - 支持GitHub OAuth认证
   - 支持Gitee Token认证
   - 自签名SSL证书支持，保障认证安全性

3. **两因素认证(2FA)**
   - 基于TOTP (Time-based One-Time Password)的两因素认证
   - QR码生成与扫描
   - 验证倒计时提示
   - 可选启用/禁用

4. **用户界面改进**
   - 账号状态显示
   - 内置Web浏览器用于OAuth认证
   - 现代化设置界面

### 安全增强

1. **数据加密**
   - 使用Fernet对称加密保护本地账号数据
   - 密钥管理与自动恢复机制
   - 加密错误自动修复

2. **SSL支持**
   - 自签名SSL证书生成与管理
   - HTTPS用于OAuth回调服务器
   - 证书有效期检查与自动更新

3. **容错机制**
   - 加密错误自动恢复
   - 密钥与账号数据损坏检测
   - 备份与恢复策略

### 技术改进

1. **代码架构**
   - 模块化设计，便于扩展
   - 信号-槽机制实现UI响应
   - 异步操作避免UI卡顿

2. **依赖更新**
   - 新增cryptography库用于加密
   - 新增pyopenssl库用于SSL证书管理
   - 新增qrcode库支持两因素认证

3. **兼容性改进**
   - 跨平台字符编码处理
   - 网络错误处理优化
   - 端口占用自动检测与切换 